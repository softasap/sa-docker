- name: install the 'Development tools' package group
  yum:
    name: "@Development tools"
    state: present
  become: yes
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'
  tags:
    - docker-compose


- block:

  - name: Docker Composer | Set fact pip to use
    set_fact:
      docker_compose_pip_executable: pip
    tags:
      - docker-compose

  when: ansible_python_version is version_compare('3','<')

- block:

  - name: Docker Composer | Set fact pip to use
    set_fact:
      docker_compose_pip_executable: pip3
    tags:
      - docker-compose

  when: ansible_python_version is version_compare('3','>=')

- name: Docker Composer | Installing pypi package
  pip:
     name: docker-compose
     state: present
     executable: "{{ docker_compose_pip_executable }}"
  retries: 3
  register: result
  until: result is not failed
  when: docker_compose_venv_directory is not defined
  become: yes
  tags:
    - docker-compose

- name: Docker Composer | Installing pypi package in venv
  pip: name=docker-compose  virtualenv="{{ docker_compose_venv_directory }}" state=present
  retries: 3
  register: result
  until: result is not failed
  when: docker_compose_venv_directory is defined
  become: yes
  tags:
    - docker-compose
